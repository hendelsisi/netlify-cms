<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CMS</title>
  <style>
    /* Critical isolation styles */
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #cms-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
      background: white;
    }
  </style>
</head>
<body>
  <!-- Isolated container for CMS -->
  <div id="cms-container"></div>

  <!-- Modern loading approach -->
  <script type="module">
    // Clean up any previous instances
    const cleanup = () => {
      const container = document.getElementById('cms-container');
      if (container) {
        container.innerHTML = '';
      }
      if (window.CMS?.dispose) {
        window.CMS.dispose();
      }
    };

    // Initialize fresh instance
    const initCMS = async () => {
      cleanup();
      
      // Dynamic import for better error handling
      try {
        await import('https://unpkg.com/decap-cms@3.7.1/dist/decap-cms.js');
        
        if (window.CMS) {
          window.CMS.init();
          console.log('CMS initialized successfully');
          
          // Force redraw to prevent DOM issues
          requestAnimationFrame(() => {
            document.getElementById('cms-container').style.display = 'block';
          });
        }
      } catch (error) {
        console.error('CMS initialization failed:', error);
        document.getElementById('cms-container').innerHTML = `
          <div style="padding: 2rem; color: red;">
            CMS failed to load. Please refresh or check console.
          </div>
        `;
      }
    };

    // Initialize after slight delay to ensure DOM stability
    setTimeout(initCMS, 50);
  </script>
</body>
</html>
